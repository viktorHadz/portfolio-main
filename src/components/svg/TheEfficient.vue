<script setup>
import { onMounted, onUnmounted } from 'vue'
import { gsap } from 'gsap'
import MotionPathPlugin from 'gsap/MotionPathPlugin'

gsap.registerPlugin(MotionPathPlugin)

let ctx, dotTl, bulbTl, card

const moveDot = (start, end) => ({
  motionPath: {
    path: '#wire',
    align: '#wire',
    alignOrigin: [0.5, 0.5],
    start,
    end,
  },
})

function createDotTimeline() {
  gsap.set('.el-dot', { opacity: 0 })
  return gsap
    .timeline({
      paused: true,
      repeat: -1,
      defaults: { duration: 1, ease: 'sine.inOut' },
    })
    .to('.el-dot', { opacity: 1, duration: 0.4 })
    .to('.el-dot', moveDot(0, 1))
}

function createBulbTimeline() {
  gsap.set('#bulb-glass', { fillOpacity: 0.2 })
  gsap.set(['#bulb-arr-sm', '#bulb-arr-lg'], {
    scaleY: 0,
    transformOrigin: 'bottom center',
  })

  return gsap
    .timeline({ paused: true })
    .to('#bulb-icon', {
      scale: 0.9,
      y: 3,
      duration: 0.2,
      ease: 'power1.inOut',
    })
    .to('#bulb-icon', {
      scale: 1,
      y: 0,
      duration: 0.2,
      ease: 'power1.inOut',
    })
    .to('#bulb-glass', { fillOpacity: 1, duration: 0.5 }, '+=0.2')
    .to(
      ['#bulb-arr-sm', '#bulb-arr-lg'],
      {
        scaleY: 1,
        duration: 0.5,
        ease: 'power2.out',
      },
      '<',
    ) // expand arrows at same time as bulb glow
}

onMounted(() => {
  ctx = gsap.context(() => {
    dotTl = createDotTimeline()
    bulbTl = createBulbTimeline()
    card = document.querySelector('.the-efficient')
    if (!card) return

    const onEnter = () => {
      dotTl.restart()
      bulbTl.restart()
    }
    const onLeave = () => {
      dotTl.pause(0)
      bulbTl.reverse()
    }

    card.addEventListener('mouseenter', onEnter)
    card.addEventListener('mouseleave', onLeave)

    card._onEnter = onEnter
    card._onLeave = onLeave
  })
})

onUnmounted(() => {
  if (card) {
    card.removeEventListener('mouseenter', card._onEnter)
    card.removeEventListener('mouseleave', card._onLeave)
  }
  ctx?.revert()
})
</script>

<template>
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 501 501">
    <path
      id="wire"
      class="stroke-white"
      d="m376.52 184.6.31 51.13-143.51 82.57"
    />

    <circle class="el-dot fill-yellow-300" cx="376.57" cy="186.32" r="12.39" />

    <g id="bulb-button">
      <path
        fill="color(display-p3 .9451 .949 .949)"
        d="M432.04 65.83c-1.57-.96-3.8-.82-6.26.58l-98.7 57.02h-.02c-4.85 2.8-8.77 9.62-8.77 15.21l.2 69.31c.02 2.76.99 4.72 2.59 5.63l-10.45-6.05c-1.57-.94-2.56-2.87-2.56-5.65l-.2-69.3c-.02-5.6 3.92-12.42 8.8-15.23l98.7-56.98c2.42-1.43 4.63-1.54 6.25-.6l10.42 6.06Z"
      />
      <path
        fill="#000"
        d="M321.08 214.33a.75.75 0 0 1-.37-.1l-.02-.01-10.43-6.05c-1.89-1.11-2.93-3.34-2.93-6.29l-.2-69.3a.74.74 0 0 1 1.49 0l.2 69.3c0 2.4.78 4.17 2.2 5l7.23 4.2a9.84 9.84 0 0 1-.5-3.13l-.2-69.3a.75.75 0 0 1 1.5 0l.2 69.3c.02 2.4.8 4.17 2.2 4.98v.01a.74.74 0 0 1-.37 1.4Zm6.01-90.16a.74.74 0 0 1-.37-1.4l98.7-57a9.74 9.74 0 0 1 3.02-1.17l-7.2-4.2c-1.43-.83-3.39-.63-5.5.6l-36.42 21.04a.75.75 0 0 1-.75-1.3l36.42-21.03c2.6-1.5 5.08-1.72 7-.59l10.35 6.02.09.05a.75.75 0 0 1-.76 1.28l-.07-.04c-1.4-.8-3.34-.58-5.44.64l-98.7 57a.75.75 0 0 1-.37.1Zm-10.42-6.07a.75.75 0 0 1-.37-1.4l39.21-22.64a.75.75 0 0 1 .75 1.3L317.04 118a.76.76 0 0 1-.37.1Z"
      />
      <path
        fill="#000"
        d="M307.87 133.32a.75.75 0 0 1-.75-.75c-.01-5.82 4.1-12.94 9.17-15.87a.75.75 0 0 1 .75 1.3c-4.66 2.68-8.44 9.22-8.42 14.57 0 .41-.34.75-.75.75Z"
      />
      <path
        fill="#fff"
        d="M327.1 123.4c-4.88 2.82-8.81 9.64-8.8 15.23l.2 69.3c.02 5.6 3.98 7.86 8.85 5.05l98.7-56.99c4.85-2.8 8.79-9.62 8.77-15.21l-.2-69.3c0-5.6-3.97-7.86-8.82-5.06l-98.7 56.99Z"
      />
      <path
        fill="#000"
        d="M323.4 214.94c-.97 0-1.88-.23-2.68-.7-1.9-1.09-2.95-3.33-2.96-6.3l-.2-69.3c-.01-5.83 4.1-12.95 9.17-15.88l98.7-56.98c2.6-1.5 5.07-1.72 6.98-.62 1.9 1.1 2.96 3.34 2.97 6.31l.2 69.3c0 5.83-4.1 12.95-9.15 15.87l-98.7 56.99a8.8 8.8 0 0 1-4.33 1.3Zm4.07-90.88c-4.66 2.69-8.43 9.22-8.42 14.57l.2 69.3c0 2.42.8 4.2 2.21 5.02 1.44.83 3.4.6 5.52-.62l98.7-56.99c4.65-2.68 8.42-9.21 8.4-14.56l-.2-69.3c0-2.43-.79-4.21-2.21-5.03-1.43-.82-3.38-.6-5.5.62l-98.7 56.99Z"
      />
      <g id="bulb-icon" fill-opacity="1">
        <path
          id="Vector_11"
          fill="color(display-p3 1 .9216 .3451)"
          d="M376.56 107.46c15.5-8.94 27.93-1.68 27.98 16.13.05 17.8-12.3 39.38-27.8 48.33-15.5 8.95-28.09 1.77-28.14-16.03-.05-17.81 12.46-39.48 27.96-48.43Z"
        />
        <path
          id="Vector_12"
          fill="#000"
          d="M364.15 176.52c-2.8 0-5.4-.65-7.7-1.97-5.52-3.18-8.57-9.8-8.6-18.67-.05-18 12.66-40.02 28.33-49.07 7.71-4.44 14.99-5.15 20.5-1.98 5.52 3.18 8.57 9.84 8.6 18.76.05 18-12.59 39.98-28.17 48.97-4.56 2.64-8.97 3.96-12.96 3.96Zm24.9-72.15c-3.7 0-7.82 1.25-12.13 3.74-15.25 8.8-27.63 30.24-27.58 47.77.03 8.3 2.82 14.47 7.86 17.38 5.07 2.92 11.88 2.21 19.16-1.99 15.18-8.76 27.48-30.15 27.43-47.68-.02-8.36-2.81-14.57-7.86-17.47a13.61 13.61 0 0 0-6.87-1.75Z"
        />
        <path
          id="Vector_13"
          fill="color(display-p3 .8471 .5429 .2941)"
          d="M370.47 125.64a3.25 3.25 0 0 1 2.24-.5l16.5 3.25c2.36.46 2.37 4.43.02 7.62l-16.43 22.27a7.56 7.56 0 0 1-2.23 2.09c-2.08 1.2-4.02.41-4.03-2.3l-.07-25.5a8.8 8.8 0 0 1 4-6.93Z"
        />
        <path
          id="Vector_14"
          fill="#000"
          d="M368.75 161.66c-.51 0-1-.12-1.43-.37-.98-.56-1.53-1.7-1.53-3.21l-.07-25.52a.74.74 0 0 1 1.49 0l.07 25.51c0 .96.28 1.64.79 1.93.52.3 1.3.2 2.12-.28.7-.4 1.4-1.06 2-1.89l16.43-22.27c1.54-2.08 1.88-4.37 1.42-5.55-.2-.5-.52-.8-.98-.89l-10.48-2.06a.75.75 0 0 1 .29-1.46l10.47 2.06c.97.19 1.7.83 2.09 1.81.73 1.88.09 4.69-1.6 6.98l-16.43 22.27a8.33 8.33 0 0 1-2.46 2.3c-.75.42-1.5.64-2.19.64Z"
        />
      </g>
    </g>

    <g id="floor">
      <g id="floor_2">
        <path
          fill="color(display-p3 .6863 .8471 .2941)"
          d="m283.85 333.95-.07 25.73-29.3 64.15.07-25.73 29.3-64.15Z"
        />
        <path
          fill="#fff"
          d="m254.55 398.1-.08 25.73L143.86 441l.07-25.73 110.62-17.16Z"
        />
        <path
          fill="color(display-p3 .6863 .8471 .2941)"
          d="m79.96 404.1-17.38-10.04.07-25.72 81.28 46.92-.07 25.73-33.03-19.07"
        />
        <path
          fill="#fff"
          d="m283.85 333.96-29.3 64.15-110.62 17.16-81.27-46.93 29.26-64.13 110.65-17.18 81.28 46.93Z"
        />
        <path
          fill="color(display-p3 .6863 .8471 .2941)"
          d="m252.51 338.82-21 45.98-79.28 12.3-58.25-33.64 20.97-45.96 79.3-12.31 58.26 33.63Z"
        />
      </g>
      <g id="floor-outline" fill="#000">
        <path
          d="M254.47 424.58c-.05 0-.1 0-.16-.02a.74.74 0 0 1-.58-.73l.07-25.73c0-.1.02-.2.07-.3l29.3-64.15c.14-.32.49-.5.83-.42.35.07.6.38.59.73l-.07 25.73c0 .1-.03.2-.07.3l-29.3 64.15a.75.75 0 0 1-.68.44Zm.82-26.31-.06 22.11 27.8-60.86.06-22.12-27.8 60.87Z"
        />
        <path
          d="M143.86 441.74a.75.75 0 0 1-.74-.75l.07-25.73c0-.37.27-.68.63-.73l110.62-17.16a.75.75 0 0 1 .85.74l-.07 25.72c0 .37-.27.68-.63.74l-110.61 17.16h-.12Zm.82-25.84-.07 24.22 109.12-16.93.07-24.21-109.12 16.92Z"
        />
        <path
          d="M143.86 441.73a.74.74 0 0 1-.37-.1l-33.03-19.06a.75.75 0 0 1 .74-1.3l31.92 18.43.07-24.01-79.8-46.07-.06 24.01 17.01 9.82a.75.75 0 0 1-.75 1.3L62.21 394.7a.74.74 0 0 1-.37-.65l.07-25.73a.75.75 0 0 1 1.12-.64l81.28 46.92c.23.14.37.38.37.65l-.07 25.73a.75.75 0 0 1-.75.74Z"
        />
        <path
          d="M143.93 416a.76.76 0 0 1-.37-.1l-81.28-46.92a.75.75 0 0 1-.3-.96l29.26-64.12c.1-.23.32-.4.56-.43l110.65-17.18a.7.7 0 0 1 .49.09l81.28 46.93c.33.19.46.6.3.95l-29.3 64.15a.74.74 0 0 1-.56.43L144.04 416h-.1Zm-80.32-47.97 80.47 46.45 109.95-17.06 28.85-63.16-80.46-46.46-110 17.08-28.8 63.15Z"
        />
        <path
          d="M187.8 392.33a.75.75 0 0 1-.11-1.48l43.32-6.72 20.55-45-57.44-33.16-78.65 12.21-20.53 44.98 20.97 12.1a.75.75 0 0 1-.74 1.3L93.6 364.12a.75.75 0 0 1-.3-.96l20.97-45.97c.1-.23.31-.38.56-.42l79.3-12.32c.18-.02.35.01.5.1l58.25 33.63c.34.2.47.6.3.95l-21 45.98a.74.74 0 0 1-.56.43l-43.72 6.78-.12.01Z"
        />
      </g>
    </g>

    <g id="bulb-arr-sm">
      <path
        id="Vector"
        fill="#fff"
        fill-opacity="1"
        d="m328.28 345.84 10.93 6.35.18 65.69-10.93-6.35-.18-65.69Z"
      />
      <path
        id="Vector_2"
        fill="#000"
        fill-opacity="1"
        d="M339.38 418.63a.75.75 0 0 1-.37-.1l-10.93-6.36a.74.74 0 0 1-.37-.64l-.18-65.68c0-.27.14-.52.37-.65a.75.75 0 0 1 .75 0l10.93 6.35c.23.13.37.38.37.64l.18 65.69a.75.75 0 0 1-.75.75Zm-10.18-7.53 9.43 5.48-.17-63.95-9.43-5.49.17 63.96Z"
      />
      <g id="Vector_3">
        <path
          fill="color(display-p3 1 .9216 .3451)"
          d="m331.95 322.08 7.5-14.02 10.93 6.35-24.27 45.35-10.93-6.35 8.2-15.3"
        />
        <path
          fill="color(display-p3 .8471 .5429 .2941)"
          d="m350.39 314.41 24.45 17.22-13.1 7.56.18 65.68-22.54 13.01-.17-65.68-13.1 7.56 24.28-45.35Z"
        />
      </g>
      <path
        id="Vector_4"
        fill="#000"
        fill-opacity="1"
        d="M326.11 360.5a.74.74 0 0 1-.38-.1l-10.92-6.35a.74.74 0 0 1-.28-1l8.19-15.3c.2-.36.65-.5 1-.3.37.19.5.64.31 1l-7.85 14.67 9.64 5.6 23.57-44.03-9.64-5.6-7.13 13.33c-.2.37-.65.5-1.01.31a.75.75 0 0 1-.3-1.01l7.5-14.01a.73.73 0 0 1 .44-.37.7.7 0 0 1 .58.08l10.93 6.34c.35.2.47.64.28 1l-24.27 45.35a.74.74 0 0 1-.66.39Z"
      />
      <path
        id="Vector_5"
        fill="#000"
        fill-opacity="1"
        d="M339.38 418.63a.75.75 0 0 1-.75-.74l-.17-64.4-11.98 6.92a.75.75 0 0 1-1.03-1l24.28-45.35a.75.75 0 0 1 1.08-.26l24.45 17.22a.74.74 0 0 1-.06 1.26l-6.22 3.59a.74.74 0 0 1-.75-1.3l5.22-3-22.8-16.06L328 357.8l10.83-6.26a.74.74 0 0 1 1.12.64l.17 64.4 21.05-12.15-.11-37.26c0-.41.33-.75.74-.75.42 0 .75.33.75.74l.11 37.7c0 .26-.14.51-.37.65l-22.54 13.01a.74.74 0 0 1-.37.1Z"
      />
    </g>

    <g id="bulb-arr-lg">
      <path
        id="Vector_6"
        fill="#fff"
        fill-opacity="1"
        d="m391.4 280.23 10.92 6.35.18 94.86-10.93-6.35-.18-94.86Z"
      />
      <path
        id="Vector_7"
        fill="#000"
        fill-opacity="1"
        d="M402.5 382.19a.75.75 0 0 1-.38-.1l-10.93-6.36a.74.74 0 0 1-.37-.64l-.18-94.86c0-.27.14-.52.37-.65a.76.76 0 0 1 .75 0l10.93 6.36c.23.13.37.37.37.64l.18 94.86a.75.75 0 0 1-.75.75Zm-10.2-7.53 9.44 5.48-.17-93.13-9.44-5.49.18 93.14Z"
      />
      <g id="Vector_8">
        <path
          fill="color(display-p3 .8748 .9322 .7349)"
          d="m395.07 256.46 7.5-14.01 10.93 6.34-24.28 45.35-10.92-6.35 8.19-15.3"
        />
        <path
          fill="color(display-p3 .6863 .8471 .2941)"
          d="m413.5 248.8 24.45 17.2-13.1 7.57.19 94.86-22.54 13.01-.18-94.86-13.1 7.56 24.28-45.34Z"
        />
      </g>
      <path
        id="Vector_9"
        fill="#000"
        fill-opacity="1"
        d="M389.22 294.89a.74.74 0 0 1-.37-.1l-10.93-6.36a.74.74 0 0 1-.28-1l8.19-15.3a.74.74 0 0 1 1.31.71l-7.85 14.67 9.64 5.6 23.57-44.03-9.64-5.6-7.13 13.33c-.2.37-.65.5-1.01.3a.75.75 0 0 1-.3-1l7.5-14.02c.09-.18.25-.3.45-.36a.7.7 0 0 1 .57.07l10.93 6.35c.35.2.48.64.28 1l-24.27 45.34a.75.75 0 0 1-.66.4Z"
      />
      <path
        id="Vector_10"
        fill="#000"
        fill-opacity="1"
        d="M402.5 382.2a.75.75 0 0 1-.75-.75l-.18-93.58-11.97 6.92a.75.75 0 0 1-1.04-1l24.28-45.35c.1-.18.28-.32.49-.37a.7.7 0 0 1 .6.12l24.45 17.2a.74.74 0 0 1-.06 1.26l-6.22 3.6a.75.75 0 0 1-.75-1.3l5.22-3-22.81-16.06-22.65 42.3 10.83-6.25a.74.74 0 0 1 1.12.64l.18 93.58L424.29 368l-.11-56.58c0-.42.33-.75.74-.75s.75.33.75.75l.1 57.01c0 .27-.13.52-.36.65l-22.54 13.01a.74.74 0 0 1-.37.1Z"
      />
    </g>

    <g id="bulb-floor">
      <path
        fill="color(display-p3 .8196 .8275 .8314)"
        d="M173.21 371.17a35.89 35.89 0 1 0 0-71.78 35.89 35.89 0 0 0 0 71.78Z"
      />
      <path
        fill="#000"
        d="M173.21 371.92a36.68 36.68 0 0 1-36.63-36.63 36.68 36.68 0 0 1 36.63-36.64 36.68 36.68 0 0 1 36.64 36.64 36.67 36.67 0 0 1-36.64 36.63Zm0-71.78a35.18 35.18 0 0 0-35.14 35.15 35.18 35.18 0 0 0 35.14 35.14 35.18 35.18 0 0 0 35.15-35.14 35.18 35.18 0 0 0-35.15-35.15Z"
      />
      <path
        fill="color(display-p3 .9451 .949 .949)"
        d="M173.74 353.94c-13.64.06-27.32-2.92-37.75-8.94-10.39-6-15.58-13.87-15.55-21.73l.06-20.7c-.03 7.86 5.16 15.73 15.55 21.73 20.66 11.92 54.08 11.92 74.61 0 10.2-5.93 15.3-13.7 15.33-21.46l-.06 20.7c-.03 7.77-5.13 15.53-15.33 21.46-10.16 5.9-23.49 8.89-36.86 8.94Z"
      />
      <path
        fill="#000"
        d="M173.37 354.7c-14.06 0-27.74-3.27-37.75-9.05-10.3-5.94-15.95-13.9-15.93-22.38l.06-20.7a.75.75 0 1 1 1.5 0c-.03 7.93 5.36 15.42 15.17 21.08 20.44 11.8 53.57 11.8 73.87 0 9.62-5.59 14.93-12.98 14.95-20.81 0-.41.34-.75.75-.75s.75.34.75.75l-.06 20.7c-.02 6.9-3.76 13.41-10.8 18.84a.74.74 0 1 1-.91-1.18c6.66-5.14 10.2-11.24 10.21-17.66l.04-13.29c-2.29 5.54-7.13 10.6-14.18 14.7-20.7 12.03-54.52 12.04-75.36 0-7.22-4.17-12.16-9.33-14.46-14.96l-.03 13.28c-.02 7.94 5.37 15.43 15.18 21.09 10.21 5.9 24.35 9.1 38.79 8.83a.75.75 0 0 1 .03 1.5h-1.82Z"
      />
      <path
        fill="#fff"
        d="M210.42 281.08c20.66 11.93 20.77 31.29.25 43.22-20.53 11.93-53.96 11.93-74.62 0-20.66-11.93-20.74-31.28-.21-43.2 20.53-11.93 53.92-11.95 74.58-.02Z"
      />
      <path
        fill="#000"
        d="M173.4 333.97c-13.64 0-27.3-3-37.73-9.03-10.25-5.92-15.9-13.84-15.92-22.3-.01-8.41 5.57-16.3 15.71-22.19 20.71-12.03 54.5-12.04 75.33-.02 10.27 5.93 15.93 13.86 15.94 22.33.01 8.42-5.56 16.3-15.7 22.18-10.35 6.02-23.98 9.03-37.63 9.03Zm-.3-61.08c-13.37 0-26.73 2.95-36.89 8.85-9.66 5.62-14.98 13.04-14.97 20.9.01 7.9 5.4 15.37 15.18 21.01 20.43 11.8 53.57 11.8 73.87 0 9.65-5.6 14.96-13.03 14.95-20.89-.01-7.91-5.4-15.39-15.2-21.03-10.2-5.9-23.57-8.84-36.93-8.84Z"
      />
    </g>

    <g id="bulb">
      <path
        id="bulb-glass"
        class="fill-yellow-300"
        fill-opacity="0.2"
        d="M270.93 158.8a97.36 97.36 0 0 1-24.6 69.08c-17.29 19.47-27.02 44.26-28.32 70.16v.35h-.02c.08 6.61-4.2 13.3-12.9 18.35-17.47 10.15-45.9 10.15-63.49 0-8.73-5.01-13.15-11.74-13.21-18.35v-.12c-1.36-26.37-11.86-51.39-29.2-71.45a97.16 97.16 0 0 1-23.78-63.9c0-55.28 45.84-99.82 101.54-97.7 50.62 1.89 91.92 42.95 93.98 93.58Z"
      />
      <path
        id="bulb-outline"
        fill="#000"
        fill-opacity="1"
        d="M173.39 325.08c-11.63 0-23.28-2.56-32.16-7.69-8.57-4.92-13.53-11.84-13.6-18.99-1.31-25.75-11.62-50.97-29.02-71.09a98.33 98.33 0 0 1-23.95-64.38 97.72 97.72 0 0 1 30.2-71 97.68 97.68 0 0 1 72.11-27.45c.41.02.73.36.72.78-.02.4-.27.75-.78.71A96.12 96.12 0 0 0 105.9 93a96.25 96.25 0 0 0-29.75 69.93 96.85 96.85 0 0 0 23.6 63.4c17.6 20.38 28.04 45.91 29.38 71.9.06 6.76 4.74 13.21 12.84 17.87 17.36 10.02 45.5 10.01 62.74 0 8.16-4.73 12.6-11.02 12.53-17.7 0-.05 0-.1.02-.16v-.2c1.32-26.35 11.44-51.43 28.5-70.65a96.46 96.46 0 0 0 24.42-68.56.75.75 0 0 1 .72-.78c.47 0 .76.3.77.72a97.95 97.95 0 0 1-24.79 69.62c-16.84 18.96-26.83 43.71-28.13 69.69v.32l-.01.15c0 7.18-4.7 13.86-13.28 18.84-8.83 5.13-20.44 7.7-32.07 7.7Z"
      />
      <path
        id="wolfram"
        fill="#000"
        fill-opacity="1"
        d="M165.5 309.2c-.31 0-.6-.2-.7-.5l-21.72-64.82a.75.75 0 0 1 .12-.7.7.7 0 0 1 .65-.28l9.94.78 10.15-12.53c.16-.2.4-.3.64-.28l9.91.78 8.69-11.57a.7.7 0 0 1 .72-.29l8.98 1.51 9.17-11.3c.22-.28.6-.36.91-.2.32.15.48.51.39.85l-22.97 89.81a.74.74 0 1 1-1.44-.36l22.12-86.52-7.3 9a.74.74 0 0 1-.7.26l-8.96-1.5-8.66 11.53c-.16.2-.42.34-.66.3l-9.93-.78-10.14 12.54c-.16.19-.4.32-.64.27l-9.21-.72 21.35 63.74a.75.75 0 0 1-.71.98Z"
      />
    </g>
  </svg>
</template>
